<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Isulew&#39;s Blog</title>
    <link>https://netcookies.github.io/b/tags/kvm/index.xml</link>
    <description>Recent content on Isulew&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-US</language>
    <atom:link href="https://netcookies.github.io/b/tags/kvm/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>架设kvm虚拟化服务器 </title>
      <link>https://netcookies.github.io/b/blog/%E6%9E%B6%E8%AE%BEkvm%E8%99%9A%E6%8B%9F%E5%8C%96%E6%9C%8D%E5%8A%A1%E5%99%A8/</link>
      <pubDate>Thu, 29 May 2014 17:07:00 +0800</pubDate>
      
      <guid>https://netcookies.github.io/b/blog/%E6%9E%B6%E8%AE%BEkvm%E8%99%9A%E6%8B%9F%E5%8C%96%E6%9C%8D%E5%8A%A1%E5%99%A8/</guid>
      <description>

&lt;p&gt;软硬件环境：
*   ubuntu-14.04-server-amd64.iso
*   ibm x3550 m3&lt;/p&gt;

&lt;p&gt;工具：
*   ultra-iso
*   u盘（用来制作启动盘）
*   putty
*   TightVNC&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&#34;制作启动盘&#34;&gt;制作启动盘&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;1.  通过ultra-iso打开ubuntu-14.04-server-amd64.iso
2.  点击启动 -&amp;gt; 写入硬盘映像，点击格式化 *fat32 快速格式化*  
3.  写入并等待完成
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;p&gt;###安装ubuntu过程
    注意以下三点
        1.  语言有中文但是因为默认没有配置字体，故还是选en_US的比较好
        2.  配置network默认是dhcp，dhcp取得ip后，back至上一步手动分配个静态ip。服务器还是静态比较靠谱&lt;/p&gt;

&lt;h2 id=&#34;3-安装服务的时候-openssh-samba勾上-便于远程管理-ssh虽然能传文件-但感觉不是那么方便哈哈&#34;&gt;3.  安装服务的时候，openssh、samba勾上，便于远程管理，ssh虽然能传文件，但感觉不是那么方便哈哈&lt;/h2&gt;

&lt;p&gt;###kvm
1.  要安装必要的软件包，从终端中输入：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    sudo apt-get install qemu-kvm libvirt-bin

在安装了libvirt-bin后，用于管理虚拟机的用户需要被添加到libvirtd组。这样做会赋予这个用户   进入到高级网络选项的权限。

    sudo adduser $USER libvirtd
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;安装virt-install&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo apt-get install virtinst
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;安装guest&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo virt-install -n web_devel -r 256 \
--disk path=/var/lib/libvirt/images/web_devel.img,bus=virtio,size=4 -c \
ubuntu-14.04-server-i386.iso --network network=default,model=virtio \
--graphics vnc,listen=0.0.0.0 --noautoconsole -v
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;网络配置&lt;/p&gt;

&lt;p&gt;如果按第3步中_network=default_，guest可以访问外网，但不能访问host和其他guest。如果用作服务器的话，显然不行。
故如下配置bridge:
安装bridge相关工具&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    sudo apt-get install bridge-utils
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;编辑/etc/network/interfaces&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    auto lo
    iface lo inet loopback

    auto eth0
    iface eth0 inet manual

    auto br0
    iface br0 inet static
            address 192.168.0.10
            network 192.168.0.0
            netmask 255.255.255.0
            broadcast 192.168.0.255
            gateway 192.168.0.1
            bridge_ports eth0
            bridge_stp off
            bridge_fd 0
            bridge_maxwait 0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;or DHCP:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    auto lo
    iface lo inet loopback

    auto eth0
    iface eth0 inet manual

    auto br0
    iface br0 inet dhcp
            bridge_ports eth0
            bridge_stp off
            bridge_fd 0
            bridge_maxwait 0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;重启网络服务：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    sudo /etc/init.d/networking restart
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    sudo ifup br0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;通过virsh创建bridge虚拟网络:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    virsh
    net-create bridge.xml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;xml内容：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    &amp;lt;network&amp;gt;
    &amp;lt;name&amp;gt;host-bridge&amp;lt;/name&amp;gt;
    &amp;lt;forward mode=&amp;quot;bridge&amp;quot;/&amp;gt;
    &amp;lt;bridge name=&amp;quot;br0&amp;quot;/&amp;gt;
    &amp;lt;/network&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;编辑guest配置，将网络由nat模式改为bridge&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    edit &amp;lt;guest domain&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;将&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    &amp;lt;interface type=&#39;network&#39;&amp;gt;
    &amp;lt;mac address=&#39;00:11:22:33:44:55&#39;/&amp;gt;
    &amp;lt;source network=&#39;default&#39;/&amp;gt;
    &amp;lt;/interface&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;改为：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    &amp;lt;interface type=&#39;bridge&#39;&amp;gt;
    &amp;lt;mac address=&#39;00:11:22:33:44:55&#39;/&amp;gt;
    &amp;lt;source bridge=&#39;br0&#39;/&amp;gt;
    &amp;lt;/interface&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;关闭虚拟机，并重启libvirtd服务:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    sudo /etc/init.d/libvirtd restart
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;启动虚拟机，检测下是桥接是否运行正常，下图vnet0是guest虚拟网卡，br0是桥接网卡，eth1为物理网卡：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    # brctl show
    bridge name     bridge id               STP enabled     interfaces
    br0             8000.e41f13b416f6       no              eth1
                                                            vnet0
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;oem激活&lt;/p&gt;

&lt;p&gt;请参看&lt;a href=&#34;http://blog.lofyer.org/slic-for-qemu-kvm/&#34;&gt;此篇&lt;/a&gt;，这不作详解了&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
  </channel>
</rss>