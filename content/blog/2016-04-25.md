+++
date = "2016-04-25T13:43:00+08:00"
title = "自建rss服务并适配 IOS 移动端（ TTRSS + Fever )"
+++

##前言
博主不会正确吐槽，以下两段纯属凑字数，RSS 相关请直接阅读第二章节。

长久以来一直都是黑莓的情怀用户，然而黑莓实在是太不争气，其主打的最新移动终端操作系统 BB10 居然被 Facebook 放弃支持了。同时 FB 旗下的 Whatsapp 也宣布与 2016 年停止版本迭代，这可是我与夫人保持联系的主要 IM，遂只好和我心爱的 Passport 说再见了。毕竟在 Whatsapp 不能用，微信、QQ 更无意发布 BB10 原生应用的条件下，总不能把情怀当短信用吧。

![](~/12917858_1341172869242553_173701527_n.jpg)

这些天把 Passport 放入了抽屉，总算是投了 IP6s 的怀抱，做起了街机党，不得不说 Appstore 的生态环境确实是所有智能机平台中最棒的，吸引了无数优秀的开发者。其中 Unread 最好的 RSS 阅读应用之一。

Unread 提供多种 RSS 服务接入，大致分三种：收费的土豪月供 RSS 服务；免费的 Feedly 但刷新不及时又时常被墙；自建 RSS 服务（ Fever 永久授权 $30 ）。在 Feedly 不堪大用的情况下，这里咱们瞄准 Ferver ，然而 $30 只是刷个新闻也实在是性价比不高，所幸开源的 TTRSS 给咱们提供了很好的解决方案。

## TTRSS + FEVER 完整的 Web 和 移动端 RSS 阅读的实现方法

Requires:
1. Deian 7 VPS 一台
2. IPhone 6s 一部
3. Lighttpd 高性能 Web 服务端（ Apache、Ngnix 都可以 )
4. Php 5.4+
5. Postgresql 9.1+ or Mysql

### 搭建 TTRSS 服务端
1. 安装必须的软件

```bash
apt-get install lighttpd postgresql postgresql-client php5-common php5-cgi php5-cli php5-curl php5-fpm php5-pgsql php-apc
```

2. 配置数据库

* 新建 Linux 用户 ttrss `[sudo] adduser ttrss`
* 使用 Postgresql 系统用户连接系统 `[sudo] su postgres -c psql template1`
* 创建新的数据库用户、新数据库，并赋予新用户新数据库的全部权限

```bash
postgres=# CREATE USER ttrss WITH PASSWORD 'YOURPASSWORD';
postgres=# CREATE DATABASE ttrss;
postgres=# GRANT ALL PRIVILEGES ON DATABASE ttrss to ttrss;
```

* 更改超级账户 postgresq 的密码

```bash
postgres=# ALTER USER postgres WITH PASSWORD 'yourpassword' 
postgres=# \q
passwd postgres
```
*postgresql的其它疑问参考 [链接](https://wiki.debian.org/PostgreSql)*

3. 安装tt-rss

* 下载tt-rss 

```bash
cd /var/www
git clone https://tt-rss.org/git/tt-rss.git tt-rss
chown www-data:www-data -R /var/www/tt-rss
```

* 配置 lighttpd + php5

```bash
# 备份 15-fastcgi-php.conf 为 15-fastcgi-php-spwanfcgi.conf
cd /etc/lighttpd/conf-available/
cp 15-fastcgi-php.conf 15-fastcgi-php-spawnfcgi.conf

# 修改 15-fastcgi-php.conf 内容如下
# -*- depends: fastcgi -*-
# /usr/share/doc/lighttpd/fastcgi.txt.gz
# http://redmine.lighttpd.net/projects/lighttpd/wiki/Docs:ConfigurationOptions#mod_fastcgi-fastcgi

## Start an FastCGI server for php (needs the php5-cgi package)
fastcgi.server += ( ".php" =>
        ((
                "socket" => "/var/run/php5-fpm.sock",
                "broken-scriptfilename" => "enable"
        ))
)

# 加载修改后的配置调用 php5-fpm
lighttpd-enable-mod fastcgi fastcgi-php
/etc/init.d/lighttpd force-reload
```

* 通过 web 安装界面初始化 tt-rss: `http://your.site.com/tt-rss/install/`
* 配置服务 UpdatingFeeds，用于定期自动抓取 RSS 源

```bash
# 官方的方法 https://tt-rss.org/gitlab/fox/tt-rss/wikis/UpdatingFeeds
cd /etc/default
wget https://raw.githubusercontent.com/netcookies/howto.biapy.com/master/web-applications/tiny-tiny-rss/tt-rss.default -o tt-rss
cd /etc/init.d
wget https://raw.githubusercontent.com/netcookies/howto.biapy.com/master/web-applications/tiny-tiny-rss/tt-rss.init-d -o tt-rss
update-rc.d tt-rss default
service tt-rss start
```

* 安装主题和插件

```bash
# 模拟 fever 接口插件
cd ~
wget https://github.com/dasmurphy/tinytinyrss-fever-plugin/archive/master.zip
unzip master.zip
cd tinytinyrss-fever-plugin-master
cp -r fever/ /var/www/tt-rss/plugins/
cd ~
rm -rf master.zip
rm -rf tinytinyrss-fever-plugin-master
# web 端主题, feedly
wget https://github.com/levito/tt-rss-feedly-theme/archive/master.zip
unzip master.zip
cd tt-rss-feedly-theme-master
cp feedly.css /var/www/tt-rss/themes
cp -r feedly/ /var/www/tt-rss/themes
cd ~
rm -rf master.zip
rm -rf tt-rss-feedly-theme-master
# web 端主题, reeder
wget https://github.com/tschinz/tt-rss_reeder_theme/archive/master.zip
unzip master.zip
cd tt-rss_reeder_theme-master
cp reeder.css /var/www/tt-rss/themes
cp -r reeder/ /var/www/tt-rss/themes
cd ~
rm -rf master.zip
rm -rf tt-rss_reeder_theme-master
```

* 登陆 tt-rss 启用插件和主题，下面给出两个主题的预览图

![](~/Screen Shot 2016-04-26 at 11.40.54 AM.png)

![](~/Screen Shot 2016-04-26 at 11.41.39 AM.png)


### 手机端的配置
* 手机端的配置很简单，只需要填上账号、密码以及服务地址及可。
* 账号为你登录 tt-rss 使用的账号
* 密码为你在 tt-rss 的 Fever 插件里设置的密码（密码可以设置与 tt-rss 的密码一致）
* 服务器地址为 http://your.site.com/tt-rss/plugins/fever/
* 这里给出 Unread 的示意图（不仅限于 Unread 只要支持 ferver 的 RSS 阅读器都可以)

<embed src="http://player.youku.com/player.php/sid/XMTU0ODY3NDQ0MA==/v.swf" allowFullScreen="true" quality="high" width="480" height="400" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash"></embed>
